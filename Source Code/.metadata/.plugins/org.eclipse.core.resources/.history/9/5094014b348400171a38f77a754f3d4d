package com.reyzerbit.fetchDataClasses;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URL;

import org.apache.commons.io.FileUtils;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

import com.reyzerbit.Feats;
import com.reyzerbit.guis.MenuBar;

public class RecentsSystem {
	
	String recentsFilePath = new String(System.getProperty("user.home") + Feats.separate + "Documents" 
    		+ Feats.separate + "SURPG" + Feats.separate + "RequiredFiles" + Feats.separate + "Recents.json");
	
	File recentsFile = new File(recentsFilePath);
	
	public void loadRecents(){
		
		if(recentsFile.exists()){
			
			//If file exists
			JSONParser parser = new JSONParser();
			JSONObject jsonObject;
			
	        try {
	        	
	        	//Read file
				Object objLoad = parser.parse(new FileReader(recentsFile));
	            jsonObject = (JSONObject) objLoad;
	            //Get size of recents file.
		        int recNum = jsonObject.size();
		        
		        //Loop to make all recents.
		        for(int i = 0; i < recNum-1; i++){
		        	
		        	//Get recent by taking current loop number (i) and adding 1 to it.
		        	String loadNumber = Integer.toString(i+1);
		        	
		        	//Make the a string that is the name of the recent save file, received from the JSON file.
		        	String nameMenu = (String) jsonObject.get(loadNumber);
		        	
		        	//Print the name of the file.
		        	System.out.println(nameMenu);
		        	
		        	//Make a file from the received save file.
		        	File fileMenu = new File(nameMenu);
		        	
		        	//Add said file (with name) to menu bar.
		        	MenuBar.makeMenuItem(nameMenu, fileMenu);
		        	
		        }
				
			} catch (FileNotFoundException e1) {
				e1.printStackTrace();
			} catch (IOException e1) {
				e1.printStackTrace();
			} catch (ParseException e1) {
				e1.printStackTrace();
			}
			
		}else if(!recentsFile.exists()){
			
			//Make the recents file.
			System.out.println("Making recents file.");
			
			//Set download URL for later use.
			URL download = null;
			try {
				download = new URL("http://jacobaccio.github.io/Text_Files/recents.json");
			} catch (MalformedURLException e2) {
				e2.printStackTrace();
				System.out.println("Failed to set URL for recents.json");
			}
			
			//Try to download said file
			try {
				FileUtils.copyURLToFile(download, recentsFile, 30000, 30000);
			} catch (IOException e) {
				e.printStackTrace();
				System.out.println("Failed to download recents.json");
			}
			
		}
		
	}

}
